$(function(){$("#historySort select").on("change",function(e){var t=$(this);var n=t.val();window.location.href=n});if($(".module").attr("id")=="random"){$.ajax({url:baseUrl+"/feed/get-random-feed"}).success(function(e){console.log("done");window.location.href=baseUrl+"/feed/"+e.feedId}).error(function(e,t){window.location.href=baseUrl+"/random"})}$(document).on("click",".openInWindow",function(e){var t=$(this).attr("href");var n="popUp";var r="width=650,height=400,scrollbars=yes";window.open(t,n,r);event.preventDefault()});var e="";var t=$("#flash");if(t.is(":visible")){t.setRemoveTimeout(5e3)}$(".verticalFeedList").each(function(e){$(this).perfectScrollbar({wheelSpeed:50})});$("#commentList").perfectScrollbar({wheelSpeed:50});$("#youtubers").perfectScrollbar({wheelSpeed:50,suppressScrollY:true});$("#addComment").on("keyup",function(e){var t=$(this);var n=t.val();var r=t.parent().find("#remainingChars .number");if(n.length>150){r.addClass("redFont")}else{r.removeClass("redFont");r.html(150-n.length)}});$("#addComment").pressEnter(function(){var e=$(this);var t=e.val();if(t.length<=150){var n=$("#feed").attr("class").substr(5);$.ajax({url:baseUrl+"/comment/add",type:"POST",data:{feedId:n,content:t},dataType:"html"}).success(function(t){if(!isEmpty(t)){var n=$(".emptyComments");if(n.length!=0){n.replaceWith($("<ul/>",{id:"commentList",html:t}).perfectScrollbar({wheelSpeed:50}))}else{$("#commentList").append(t).perfectScrollbar("update")}e.val("");e.parent().find("#remainingChars .number").html(150)}})}else{return}});var n=false;$(".module ul.expandable").on("scroll",function(e){var t=$(this);if(t.scrollTop()===t.prop("scrollHeight")-t.height()){if(!n){n=true;var r=t.attr("id");var i=parseInt(t.attr("data-page"))+1;var s=t.attr("data-total");if(i-1>=s){var o=t.children(".limit-reached");if(o.length!=0){alert("here");console.log(o);return}else{o=$("<li />",{"class":"limit-reached",text:"There are no more feeds available."}).appendTo(t)}}else{t.toggleLoadingImage();$.ajax({url:baseUrl+"/get-more-feeds/"+r+"/"+i,dataType:"html"}).success(function(e){n=false;t.append(e).perfectScrollbar("update").toggleLoadingImage()});t.attr("data-page",i)}}}});var r=false;$("#youtubers li").on("click",function(e){var t=$(this);delay(function(){if(t.hasClass("active")||r)return;r=true;t.addClass("active");t.siblings(".active").removeClass("active");var e=$("#youtubersFeeds");var n=e.parent();var i=t.find('span[class^="youtuber"]');var s=i.attr("class").substring(9);e.slideUp();n.toggleLoadingImage();$.ajax({url:baseUrl+"/feed/get-youtuber-feeds/"+s,timeout:2e4}).done(function(t){e.html("").append(t).slideDown();e.siblings("h1").html(i.html()+"'s Latest Feeds");n.toggleLoadingImage();r=false;e.perfectScrollbar("destroy");e.perfectScrollbar({wheelSpeed:50})}).fail(function(e,t){if(t=="timeout"){alert("The search has timed out, please refresh the page and try again.")}else{addMessage("Something with wrong with the game search, please try again.")}})},150)});$(".hideToggle").on("click",function(e){var t=$(this);var n=t.siblings(".moduleBody");if(n.is(":visible")){n.slideUp();t.html("Show")}else{n.slideDown();t.html("Hide")}});$(document).on("click",function(t){if(t.target.id=="shadow"){e.unfocusLight();$("body").removeClass("unscrollable");if(e.attr("id")=="stage"){e.find("iframe").detach();e.hide()}else{e.detach()}}});$(document).on("click","#rating a",function(e){var t=$(this);if(t.attr("href")=="#"){e.preventDefault()}else{return}var n=t.siblings('a[id^="thumb"]');if(!t.hasClass("disabled")){t.addClass("disabled");var r=t.attr("id");var i=$("#feed");var s=i.attr("class").substring(5);$.ajax({url:baseUrl+"/feed/rate/"+r+"/id/"+s,timeout:5e3}).success(function(e){if(e.success==1){var t=$("#total .count");var i=parseInt(t.html());if(n.hasClass("disabled")){n.removeClass("disabled");i+=r=="thumbUp"?2:-2}else{i+=r=="thumbUp"?1:-1}t.html(i)}else{addMessage(e.message)}})}});$(document).on("click",".verticalFeedList li .videoMask",function(t){if(!isMobile){t.preventDefault();t.stopPropagation();var n=$(this).parent();var r=n.closest("li");var i=r.attr("data-video-id");var s=r.attr("class").substr(5);toggleVideo("hide");var o=$("<div/>",{id:"stageWrapper"}).prependTo($("body"));var u=$("<div/>",{id:"stage"}).appendTo(o);var a=$("<div/>",{id:"videoWrapper"}).appendTo(u);var f=$("<iframe/>",{id:"youtubeVideo",frameborder:0,src:"http://www.youtube.com/embed/"+i+"?autoplay=1"}).appendTo(a);e=o;o.addClass("target-"+i).focusLight();$("body").addClass("unscrollable");$.ajax({url:baseUrl+"/feed/add-to-watched/"+s,timeout:5e3}).success(function(e){if(e.success!=1){console.log(e.message)}})}})})